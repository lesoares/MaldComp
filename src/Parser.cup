import java_cup.runtime.*;
import arvoresintatica.*;


parser code {:
:}

/* Terminais */

terminal IF, THEN, ELSE, DEF;
terminal MAIS, MENOS, MULT, DIVISAO;
terminal ATR;
terminal MENOR, MAIOR, IGUAL;
terminal VIRG, PONTOVIRG, APARENT, FPARENT;
terminal ID;
terminal NUM;


/* Nao terminais */
non terminal programa;
non terminal instrucao;
non terminal instrucao2;
non terminal definicao;
non terminal args;
non terminal args2;
non terminal sequencia;
non terminal expressao;
non terminal expressao2;
non terminal opRel;
non terminal opArit;

/* Precedencia */
precedence left MAIS, MENOS;
precedence left MULT, DIVISAO;

/* Producoes */
start with programa;

programa ::= ID ATR NUM PONTOVIRG programa:p
			{:
				RESULT = new Programa(ID.value, NUM.value, p);
			:}
      | instrucao:i
      	{:
      		RESULT = i;
      	:} 
      ;

instrucao ::= definicao:d instrucao2:i2;
			{:
				RESULT = new Instrucao(d, i2);
			:}

instrucao2 ::= PONTOVIRG instrucao:i
			{:
				RESULT = i;
			:}
      |
     		 {:
				RESULT = NULL;
			:}
      		
      ;

definicao ::= DEF ID APARENT args FPARENT ATR expressao
			{:
				RESULT = new Def("def", ID.value, args, expressao);
			:}
		;
		
		
args ::= ID args2
			{:
				RESULT = new Args(ID.value, args2);
			:}
		;

args2 ::= VIRG args
			{:
				RESULT = args;
			:}
      |
      		{:
				RESULT = NULL;
			:}	
      ;

sequencia ::= expressao
			{:
				RESULT = expressao;
			:}
      | sequencia VIRG expressao
      		{:
				RESULT = new Sequencia(sequencia, ",", expressao);
			:}
      ;

expressao:e1 ::= NUM
		 {:
				RESULT = new Expressao(NUM.value);
		 :}
      | IF expressao:e2 opRel expressao:e3 THEN expressao:e4 ELSE expressao:e5
     	 {:
			RESULT = new Expressao("if",e2 ,opRel,e3,"then", e4,"else", e5);
		 :}
      | expressao:e1 opArit expressao:e2
     	 {:
				RESULT = new Expressao(e1, opArit, e2);
		 :}
      | ID expressao2
      	 {:
				RESULT = new Expressao(ID.value, e2);
		 :}
      ;

expressao2 ::= APARENT sequencia FPARENT
		{:
				RESULT = sequencia;
		:}
      |
      	{:
				RESULT = new Expressao2(NULL);
		:}
      ;

opRel ::= MENOR
		{:
				RESULT = "<";
		:}
      | MAIOR
      	{:
				RESULT = ">";
		:}
      | IGUAL
     	{:
				RESULT = "==";
		:}
      ;


opArit ::= MAIS
		{:
				RESULT = "+";
		:}
      | MENOS
     	{:
				RESULT = "-";
		:}
      | MULT
     	{:
				RESULT = "*";
		:}
      | DIVISAO
     	{:
				RESULT = "/";
		:}
      ;
      


